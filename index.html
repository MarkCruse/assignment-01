<!doctype html>
<!--
Mark Cruse / Rich Donahue October 2017
Add detail here.
-->
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>2015 Fish Distribution in Smoky Mountains</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: sans-serif;
            background: rgba(0,0,0,.9); /*set the background to a black*/
        }
        #map {
            position: absolute;
            width: 100%;
            top: 80px;
            bottom: 0;
            background: rgba(0,0,0,.75);
        }
        header{
            border-bottom: 1px solid white;
        }
        h1 {
            margin: 18px 0 18px 18px;
            font-weight: normal;
            color: white;
        }
        .tooltip {
            color: white;
            background: #295b97;
            border: 0;
            font-size: 1.3em;
        }
        #legend {
            min-width: 170px;
            min-height: 170px;
            background: rgba(0,0,0,.7);
            border: 1px solid white;
            border-radius: 4px;
            position: absolute;
            right: 18px;
            top: 90px;
            padding: 6px 18px;
            z-index: 1000;
        }
        #legend h3 {
            color: white;
            font-weight: normal;
            margin-top: 12px;

        }
    </style>
</head>

<body>
    <header>
        <h1>Great Smoky Mountain Fishing</h1>
    </header>
    <div id="map"></div>
    <div id="legend">
        <h3>Map symbols</h3>
    </div>

    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>
    <script>
        //** zoom options

        var options = {


        };

        // create Leaflet map and apply options
        var map = L.map('map', options);

        // add labels & tiles to the map
        map.createPane('labels');
        map.getPane('labels').style.zIndex = 650;
        map.getPane('labels').style.pointerEvents = 'none';

        // L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
        // 	attribution: 'Map data: &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',
        //     pane: 'labels'
        // }).addTo(map);

        L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_only_labels/{z}/{x}/{y}.png', {
                attribution: '©OpenStreetMap, ©CartoDB',
                pane: 'labels'
        }).addTo(map);

        // create custom icon
        var parkIcon = L.icon({
            iconUrl: 'images/parking_icon.png',
            iconSize: [15, 15], // size of the icon
            opacity: .2
            });


        // **** Options for various layers - fish distribution, parkBounds, trails, parking

        var fishOptions = {
            fillOpacity: 0,
            color: '#12b4ea',       //blue
            opacity: 1,
            weight: 1.5
        };

        var parkBoundsOptions = {
            fillOpacity: .3,
            color: '#424140',       //blue
            weight: .7,
            opacity: 1
        };

        var trailsOptions = {
            color: '#a09273',       //brown
            color: '#056010',       //green
            weight: .5,
            opacity: .9,
            dashArray: "5, 5"
        }

        var maskOptions = {
            fillOpacity: 0,
            color: '#f0f062',
            weight: .1,
            opacity: .1
        }


        // AJAX calls to load data
        $.when(
            $.getJSON('data/grsm_fish.json'),
            $.getJSON('data/grsm_trails.json'),
            $.getJSON('data/grsm_boundary.json'),
            $.getJSON('data/grsm_parking.json'),
            $.getJSON('data/grsm_carto_mask.json'),

        ).done
        (function (fish, trails, parkBounds, parking, mask) {
            drawMap(fish, trails, parkBounds, parking, mask);
            }
        );

        // ---------------------------------------------------------------

        function drawMap(fishData, trailsData, parkBoundsData, parkingData, maskData) {
            //load the data to the map rendering the color and styles for each in the particular order below
            L.geoJson(fishData, {
                style: function(feature){

                    return {
                        fillOpacity: 0,
                        color: getFishColor(feature.properties.EVENTTYPE),
                        opacity: 1,
                        weight: 1.5
                    }

                },
                onEachFeature: function(feature, layer) {
                    //console.log(layer.feature.properties);
                    tooltip_info = feature.properties.STREAMNAME+" \nType realeased: "+feature.properties.EVENTTYPE+" \nRealease Date: "+feature.properties.EVENTDATE;
                    var props = layer.feature.properties;       //assign layer properties to props
                    var content = "<b>"+ props.STREAMNAME + "</b><br>";
                        content += "Fish type(s): " + props.EVENTTYPE + " <br>";
                        content += "Release date: "+props.EVENTDATE.substring(0,10)+"<br>";
                    layer.bindTooltip(content)
                }
            }).addTo(map);


            function getFishColor(fishType) {
                console.log(fishType)
                if(fishType === "Rainbow") {
                    return '#efda1c';
                } else if(fishType === "Brook"){
                    return '#bc6207';
                } else if(fishType === "Rainbow-Brown"){
                        return '#bc6207';
                } else {
                    return '#12b4ea';
                }
            }


            L.geoJson(trailsData, {
                style: trailsOptions
            }).addTo(map);

            var parkBounds = L.geoJson(parkBoundsData, {
                 style: parkBoundsOptions
            }).addTo(map);

            // set map options dynamically from layer
            map.fitBounds(parkBounds.getBounds())
            map.setMaxBounds(parkBounds.getBounds());
            map.setMinZoom(map.getZoom() - 1);
            map.setMaxZoom(map.getZoom() + 5);

            var parking = L.geoJson(parkingData, {
                pointToLayer: function(feature, latlng) {
                    return L.marker(latlng, {icon: parkIcon});
                },
                onEachFeature: function(feature, layer) {
                    layer.on('mouseover', function() {
                        //console.log(layer.feature.properties)
                    });
                    layer.bindTooltip(feature.properties.LOC_NAME)
                }

            })

            map.on('zoomend', function() {
                if(map.getZoom() >= 14) {
                    parking.addTo(map);
                } else {
                    parking.removeFrom(map);
                }
            });
        }

    </script>
</body>

</html>
